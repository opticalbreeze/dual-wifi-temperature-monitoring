# WiFi ネットワーク接続問題の分析

## 問題概要

- **症状:** 特定のフリー WiFi に接続したとき、ラズパイの wlan0 がインターネットに接続できない
- **状態:**
  - IP 取得: 成功 (172.17.2.50)
  - Gateway 設定: 成功 (172.17.255.254)
  - **Gateway への ping: 失敗（パケット 0% 受信）**
  - PC・スマホ: 同じネットワークで接続可能

## 根本原因

**ネットワークレベルでラズパイだけがブロックされている**

理由：
- ゲートウェイが ICMP（ping）に応答していない
- ローカルゲートウェイまで到達できないのに IP は取得できている
- PC・スマホは接続できている → ラズパイ固有の問題

## 考えられる原因

### 1. MAC アドレスフィルタリング
- **最も可能性が高い**
- ラズパイの wlan0 MAC アドレスがホワイトリストに登録されていない
- または特定の MAC を明示的に拒否している

### 2. デバイスタイプ制限
- Linux デバイスを制限している可能性
- User-Agent や Client ID で識別されている可能性

### 3. DHCP クライアント ID の問題
- ラズパイのクライアント ID が拒否されている可能性

## 解決方法

### ステップ 1: ラズパイの MAC アドレスを確認

```bash
ip link show wlan0 | grep link/ether
```

出力される MAC アドレス（例：d8:3a:dd:ab:0a:2a）をメモする

### ステップ 2: ネットワーク管理者に確認

以下を確認してもらう：
- ラズパイの MAC アドレスがホワイトリストに登録されているか
- Linux/Raspberry Pi デバイスが制限されていないか
- MAC フィルタリングが有効になっていないか

### ステップ 3: MAC アドレスを変更してテスト（応急処置）

```bash
# 別の MAC アドレスを試す
sudo ip link set wlan0 address 00:11:22:33:44:55

# WiFi に再接続
sudo nmcli connection down INT_guest2
sudo nmcli connection up INT_guest2

# テスト
ping -c 4 8.8.8.8
```

もし別の MAC で接続できれば、**MAC アドレスフィルタリングが原因** と確定

## 結論

これは **コード問題ではなく、ネットワーク管理者によるセキュリティ制限** の可能性が極めて高い。

Tailscale VPN を使ってデータ収集しているのであれば、フリー WiFi からのインターネット接続は不要かもしれません。
